<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>
    jwt认证实践 |
    
    Kevin&#39;s blog</title>
  
    <link rel="shortcut icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  
    <link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">
  
  <script src="/js/pace.min.js"></script>
</head>
</html>
<body>
<main class="content">
  <section class="outer">
  <article id="post-jwt认证实践" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      jwt认证实践
    </h1>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2019/08/06/jwt认证实践/" class="article-date">
  <time datetime="2019-08-06T06:54:08.000Z" itemprop="datePublished">2019-08-06</time>
</a>
        
      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <p>在进行前后端项目开发时，身份认证是一个很重要的问题。</p>
<p>在身份认证这一块上，我们可以使用JWT来进行验证</p>
<h1 id="一，JWT简述"><a href="#一，JWT简述" class="headerlink" title="一，JWT简述"></a>一，JWT简述</h1><p>JWT(Json Web Token)是一种为了在网络应用环境之间传递声明而基于json的开放标准，JWT声明一般被采用在身份提供者和服务器提供者间传递被认证的身份信息，以便从资源服务器获取资源</p>
<p>JWT一般用于用户登录上，身份认证这种场景下，一旦用户登录完成，在接下来的每个涉及用户权限的请求中都包含JWT，可以对用户身份，路由，服务和资源的访问权限进行验证</p>
<p>举一个例子，假如一个电商网站，在用户登录以后，需要验证用户的地方其实有很多，比如购物车，订单页，个人中心等等，访问这些页面正常的逻辑是先验证用户权限和登录状态，如果验证通过，则进入访问的页面，否则重定向到登录页。</p>
<h1 id="二，JWT对比session或cookie"><a href="#二，JWT对比session或cookie" class="headerlink" title="二，JWT对比session或cookie"></a>二，JWT对比session或cookie</h1><p>在JWT之前，这样的身份认证大多数都是通过session和cookie去实现的</p>
<h2 id="1-用户身份认证cookie-session实现"><a href="#1-用户身份认证cookie-session实现" class="headerlink" title="1.用户身份认证cookie session实现"></a>1.用户身份认证cookie session实现</h2><p><img src="https://img-blog.csdn.net/2018091121224432?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2E3NTQ4OTU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt></p>
<p>浏览器第一次请求服务器时，服务器会为浏览器的这次会话（session）生成一个索引为session_id的会话数据存入服务器的后端数据库，然后在cookie中存入session_id封装在响应信息中，返回给浏览器保存在本地主机的cookie文件（追加写入），第二次请求时带上cookie信息去请求服务器，服务器解析出cookie中的session_id去查询后端数据库返回相应信息</p>
<p><strong>缺陷</strong></p>
<ol>
<li><p>服务器需要保存session数据，数据量增大，服务器性能会受到很大的影响，内存开销大</p>
</li>
<li><p>服务器session不能共享，严重的限制了服务器扩展能力， 比如说我用两个机器组成了一个集群， 小F通过机器A登录了系统，  那session id会保存在机器A上，  假设小F的下一次请求被转发到机器B怎么办？  机器B可没有小F的 session id啊。只能进行session复制转移到另一台机器</p>
<p> <img src="https://images2018.cnblogs.com/blog/1350514/201805/1350514-20180504122814029-1201707523.png" alt></p>
</li>
<li><p>基于上述解决session不能共享的问题，还可以使用redis或者Memcached中作为session共享服务器，但是，如果共享服务器挂掉，就会影响到所有服务器的会话管理</p>
<p> <img src="https://images2018.cnblogs.com/blog/1350514/201805/1350514-20180504123036062-1920411426.png" alt></p>
</li>
<li><p>使用本机cookie保存也会出现数据泄露或者遭到踹改的问题</p>
</li>
</ol>
<h2 id="2-用户身份认证JWT实现"><a href="#2-用户身份认证JWT实现" class="headerlink" title="2.用户身份认证JWT实现"></a>2.用户身份认证JWT实现</h2><h3 id="1-JWT结构"><a href="#1-JWT结构" class="headerlink" title="1.JWT结构"></a>1.JWT结构</h3><p>JWT生成的token由三部分组成，用 . 隔开</p>
<ul>
<li><p><strong>header</strong></p>
<p>  header主要包括：</p>
<ul>
<li><p>token类型</p>
</li>
<li><p>所使用的加密算法</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    typ: "jwt", </span><br><span class="line">    alg: "HS256"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>payload</strong></p>
<p>  payload主要是用来存放有效信息，有效信息中被分为标准中注册的声明，公共的声明和私有声明</p>
<p>  <strong>下面是标准中注册的声明，建议但不强制使用。</strong></p>
<ul>
<li><p>iss：jwt 签发者；</p>
</li>
<li><p>sub：jwt 所面向的用户；</p>
</li>
<li><p>aud：接收 jwt 的一方；</p>
</li>
<li><p>exp：jwt 的过期时间，这个过期时间必须要大于签发时间，这是一个秒数；</p>
</li>
<li><p>nbf：定义在什么时间之前，该 jwt 都是不可用的；</p>
</li>
<li><p>iat：jwt 的签发时间。</p>
<p>上面的标准中注册的声明中常用的有 exp 和 nbf。</p>
</li>
</ul>
<p>  <strong>公共声明</strong></p>
<p>  公共声明可以添加任何信息，一般添加用户的相关信息或其他业务需要的必要信息，但不建议添加敏感信息，该部分在客户端可以解密获得</p>
<p>  <strong>私有声明</strong></p>
<p>  私有声明是提供者和消费者所共同定义的声明，一般不建议存放敏感信息，因为 base64 是对称解密的，意味着该部分信息可以归类为明文信息。</p>
</li>
<li><p><strong>signature 签名</strong></p>
<p>  签名这一部分是指将header或payload通过秘钥进行加密后生成，秘钥存储在服务端，不会发送给任何人，所以jwt的运输方式很安全</p>
<p>  最后将三部分使用 . 连接成字符串，就是要返回给浏览器的 token 浏览器一般会将这个 token 存储在 localStorge 以备其他需要验证用户的请求使用。</p>
</li>
</ul>
<h3 id="2-实现身份认证"><a href="#2-实现身份认证" class="headerlink" title="2.实现身份认证"></a>2.实现身份认证</h3><p><img src="https://img-blog.csdnimg.cn/20190807193552928.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MTkyMjI4OQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>实现：</p>
<p>controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> LoginService loginService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 登录</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/login"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> AjaxResult <span class="title">login</span><span class="params">(@RequestParam(<span class="string">"userName"</span>)</span>String userName,</span></span><br><span class="line"><span class="function">                        @<span class="title">RequestParam</span><span class="params">(<span class="string">"password"</span>)</span>String password)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> loginService.login(userName, password);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>service:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginServiceImpl</span> <span class="keyword">implements</span> <span class="title">LoginService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LoginMapper loginMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AjaxResult <span class="title">login</span><span class="params">(String userName, String password)</span> </span>&#123;</span><br><span class="line">        Guest guest =  loginMapper.selectFromTbGuest(userName, password);</span><br><span class="line">        <span class="comment">//校验</span></span><br><span class="line">        <span class="keyword">if</span>(guest != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="comment">//校验成功</span></span><br><span class="line">            <span class="comment">//信息封装返回给前端</span></span><br><span class="line">            Map resultMap = <span class="keyword">new</span> HashMap&lt;String,String&gt;();</span><br><span class="line">            <span class="comment">//登录成功</span></span><br><span class="line">            String token = <span class="keyword">null</span>;</span><br><span class="line">            <span class="comment">//生成token</span></span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                <span class="comment">//加密用户名和密码(仅为参考，一般不存储用户的隐私敏感信息)</span></span><br><span class="line">                String key = Base64.getEncoder().encodeToString((guest.getUserName()+<span class="string">","</span>+guest.getPassword()).getBytes());</span><br><span class="line">                Map claims = <span class="keyword">new</span> HashMap();</span><br><span class="line">                claims.put(<span class="string">"key"</span>,key);</span><br><span class="line">                token = JwtUtils.createJwt(claims,<span class="string">"admin"</span>,<span class="number">720000</span>);</span><br><span class="line">                resultMap.put(<span class="string">"token"</span>,token);</span><br><span class="line">            &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">                log.error(<span class="string">"生成token失败"</span>+e.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line">            resultMap.put(<span class="string">"msg"</span>,<span class="string">"登录成功"</span>);</span><br><span class="line">            <span class="comment">//封装返回信息</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> AjaxResult().ok(resultMap);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> AjaxResult().error(<span class="string">"登录失败"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>jwt工具类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String JWT_SECRET = <span class="string">"123456789abcdefg"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 签发jwt</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> claims</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> subject   主题</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ttlMillis 存活时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">createJwt</span><span class="params">(Map claims, String subject, <span class="keyword">long</span> ttlMillis)</span></span>&#123;</span><br><span class="line">        <span class="comment">//jwt头部中的签名算法，默认是Hsha256</span></span><br><span class="line">        SignatureAlgorithm signatureAlgorithm = SignatureAlgorithm.HS256;</span><br><span class="line">        <span class="comment">//jwt签发时间</span></span><br><span class="line">        <span class="keyword">long</span> now = System.currentTimeMillis();</span><br><span class="line">        Date nowTime = <span class="keyword">new</span> Date(now);</span><br><span class="line">        <span class="comment">//生成签名时使用的秘钥</span></span><br><span class="line">        SecretKey secretKey = generalKey();</span><br><span class="line">        <span class="comment">//构造payload</span></span><br><span class="line">        JwtBuilder jwtBuilder = Jwts.builder()</span><br><span class="line">                .setClaims(claims)</span><br><span class="line">                .setIssuedAt(nowTime)</span><br><span class="line">                .setSubject(subject)</span><br><span class="line">                .signWith(signatureAlgorithm,secretKey);</span><br><span class="line">        <span class="keyword">if</span>(ttlMillis &gt;= <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">//设置过期时间</span></span><br><span class="line">            Date expireTime = <span class="keyword">new</span> Date(now + ttlMillis);</span><br><span class="line">            jwtBuilder.setExpiration(expireTime);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="keyword">return</span> jwtBuilder.compact();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 签名秘钥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> SecretKey <span class="title">generalKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//使用base64解码</span></span><br><span class="line">        <span class="keyword">byte</span>[] data = Base64.decodeBase64(JWT_SECRET);</span><br><span class="line">        <span class="comment">//AES构造指定的秘钥</span></span><br><span class="line">        SecretKey secretKey = <span class="keyword">new</span> SecretKeySpec(data,<span class="number">0</span>,data.length,<span class="string">"AES"</span>);</span><br><span class="line">        <span class="keyword">return</span> secretKey;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 解析jwt获取claims数据对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jwt</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Claims <span class="title">parseJWT</span><span class="params">(String jwt)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        SecretKey secretKey = generalKey();</span><br><span class="line">        Claims claims = Jwts.parser()</span><br><span class="line">                .setSigningKey(secretKey)</span><br><span class="line">                .parseClaimsJws(jwt)</span><br><span class="line">                .getBody();</span><br><span class="line">        <span class="keyword">return</span> claims;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>拦截器设置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LoginMapper loginMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 预处理方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 允许跨域</span></span><br><span class="line">        response.setHeader(<span class="string">"Access-Control-Allow-Origin"</span>, <span class="string">"*"</span>);</span><br><span class="line">        String token = request.getHeader(<span class="string">"authorization"</span>);</span><br><span class="line">        <span class="comment">//服务器内置的token，用于测试接口</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"testToken"</span>.equals(token)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.----------- 解析jwt信息</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//判断token是否为null，使用Optional防止出现空指针异常（optional可以接受null值）</span></span><br><span class="line">        Optional.ofNullable(token)</span><br><span class="line">                .map(n -&gt; &#123;</span><br><span class="line">                    <span class="comment">//判断token是否过期，过期则抛出异常</span></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        log.info(<span class="string">"-----&gt;"</span>+n);</span><br><span class="line">                        <span class="keyword">return</span> JwtUtils.parseJWT(n);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                        log.warn(<span class="string">"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;token不存在!，重新授权登录！&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;"</span>);</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"token不存在!，重新授权登录！"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.------------- 数据库交互</span></span><br><span class="line"></span><br><span class="line">        String subject = JwtUtils.parseJWT(token).getSubject();</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">"admin"</span>.equals(subject))&#123;</span><br><span class="line">            <span class="comment">//管理员</span></span><br><span class="line">            <span class="comment">//取出claims中的用户标识</span></span><br><span class="line">            <span class="keyword">byte</span>[] bytes = Base64.getDecoder().decode(String.valueOf(JwtUtils.parseJWT(token).get(<span class="string">"key"</span>)));</span><br><span class="line">            <span class="comment">//byte[]转String</span></span><br><span class="line">            String userInfo = <span class="keyword">new</span> String(bytes);</span><br><span class="line">            <span class="comment">//分割userInfo，获取userName和password</span></span><br><span class="line">            String[] strs = userInfo.split(<span class="string">","</span>);</span><br><span class="line">            <span class="comment">//校验用户是否存在数据库</span></span><br><span class="line">            Guest guest = loginMapper.selectFromTbGuest(strs[<span class="number">0</span>],strs[<span class="number">1</span>]);</span><br><span class="line">            <span class="keyword">return</span> guest != <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<p><img src="https://img-blog.csdnimg.cn/20190807195656662.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MTkyMjI4OQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>使用token请求资源api</p>
<p><img src="https://img-blog.csdnimg.cn/20190807195806689.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MTkyMjI4OQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>总结：</p>
<p>JWT本身没啥难度，但是安全整体是一件比较复杂的事情，JWT只不过负责提供了一种基于token的身份验证机制，但是对于我们的用户权限，对于相应用户权限的api划分，资源的权限划分等，都不是JWT负责的，也就是说，请求验证完成，是否有权限请求对应的内容还是由用户权限决定</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kevin091827.github.io/2019/08/06/jwt认证实践/" data-id="cjz54ryh6001skwu3lbz7pvwz"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/项目总结/">项目总结</a></li></ul>

    </footer>

  </div>

  
    
  <nav class="article-nav">
    
      <a href="/2019/08/06/java8新特性-lambda表达式/" class="article-nav-link">
        <strong class="article-nav-caption">Newer posts</strong>
        <div class="article-nav-title">
          
            java8新特性 lambda表达式
          
        </div>
      </a>
    
    
      <a href="/2019/08/03/avl树/" class="article-nav-link">
        <strong class="article-nav-caption">Olde posts</strong>
        <div class="article-nav-title">avl树</div>
      </a>
    
  </nav>


  

  
    
  

</article>



</section>
  <footer class="footer">
  <div class="outer">
    <div class="float-right">
      <ul class="list-inline">
  
    <li><i class="fe fe-smile-alt"></i> <span id="busuanzi_value_site_uv"></span></li>
  
    <li><i class="fe fe-bookmark"></i> <span id="busuanzi_value_page_pv"></span></li>
  
</ul>
    </div>
    <ul class="list-inline">
      <li>&copy; 2019 Kevin&#39;s blog</li>
      <li>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></li>
      <li>Theme  <a href="https://github.com/zhwangart/hexo-theme-ocean">Ocean</a></li>
    </ul>
  </div>
</footer>

</main>
<aside class="sidebar">
  <button class="navbar-toggle"></button>

<nav class="navbar">
  
    <div class="logo">
      <a href="/"><img src="/images/hexo.svg" alt="Kevin&#39;s blog"></a>
    </div>
  
  <ul class="nav nav-main">
    
      <li class="nav-item">
        <a class="nav-item-link" href="/">Home</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/archives">Archives</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/gallery">Gallery</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/about">About</a>
      </li>
    
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="Search">
        <i class="fe fe-search"></i>
        Search
      </a>
    </li>
  </ul>
</nav>

<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      <div class="totop" id="totop">
  <i class="fe fe-rocket"></i>
</div>
    </li>
    <li class="nav-item">
      
        <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
          <i class="fe fe-feed"></i>
        </a>
      
    </li>
  </ul>
</nav>

<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
</aside>
<script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/lazyload.min.js"></script>
<script src="/js/snap.svg-min.js"></script>
<script src="/js/busuanzi-2.3.pure.min.js"></script>


  <script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/ocean.js"></script>

</body>
</html>